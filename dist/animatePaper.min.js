!function(global,paper){function _pointDiff(a,b,operator){if(-1!==["+","-"].indexOf(operator)&&"undefined"!=typeof a&&"undefined"!=typeof b){var ax,bx,ay,by;ax=a.x||0,bx=b.x||0,ay=a.y||0,by=b.y||0;var output=new paper.Point(eval(ax+operator+bx),eval(ay+operator+by));return output}}function frameManagerHandler(e){var t=this;if("undefined"!=typeof t.data._customHandlers&&t.data._customHandlersCount>0)for(var a in t.data._customHandlers)t.data._customHandlers.hasOwnProperty(a)&&"function"==typeof t.data._customHandlers[a]&&t.data._customHandlers[a].call(t,e)}function Animation(e,t,a,n){var i=this;i.stopped=!1,i.startTime=(new Date).getTime(),i.settings=_initializeSettings(a),i.item=e,i.tweens=[],i.ticker=null,i._continue=n;for(var r in t)t.hasOwnProperty(r)&&i.tweens.push(new Tween(r,t[r],i));"onFrame"===i.settings.mode&&(i.ticker=animatePaper.frameManager.add(i.item,"_animate"+i.startTime,function(){i.tick()}))}function _initializeSettings(e){var t={duration:400,easing:"linear",complete:void 0,step:void 0,mode:"onFrame"};return"undefined"==typeof e&&(e={}),"undefined"==typeof e.duration?e.duration=t.duration:(e.duration=Number(e.duration),e.duration<1&&(e.duration=t.duration)),"undefined"==typeof e.easing&&(e.easing=t.easing),"undefined"!=typeof easing[e.easing]&&easing.hasOwnProperty(e.easing)?e.easingFunction=easing[e.easing]:(e.easing=t.easing,e.easingFunction=easing[t.easing]),"function"!=typeof e.complete&&(e.complete=void 0),"function"!=typeof e.step&&(e.step=void 0),-1===["onFrame","timeout"].indexOf(e.mode)&&(e.mode=t.mode),e}function Tween(e,t,a){var n=this;n.A=a,n.item=a.item,n.prop=e,n.end=t,n.start=n.cur(),n.now=n.cur(),n.direction=n.end>n.start?"+":"-"}var animatePaper={},debug=!0,__log=function(){debug&&console.log.call(console,arguments.splice(0))};animatePaper.frameManager={add:function(e,t,a){return"undefined"==typeof e.data._customHandlers&&(e.data._customHandlers={},e.data._customHandlersCount=0),e.data._customHandlers[t]=a,e.data._customHandlersCount+=1,e.data._customHandlersCount>0&&(e.onFrame=frameManagerHandler),t},remove:function(e,t){"undefined"!=typeof e.data._customHandlers&&(e.data._customHandlers[t]=null,e.data._customHandlersCount-=1,e.data._customHandlersCount<=0&&(e.data._customHandlersCount=0))}},animatePaper.animate=function(e,t){var a=[];t instanceof Array?a=t:a.push(t);var n=0;return new Animation(e,a[n].properties,a[n].settings,function i(){n++,"undefined"!=typeof a[n]&&new Animation(e,a[n].properties,a[n].settings,i)}),e};for(var easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,a=4;e<((t=Math.pow(2,--a))-1)/11;);return 1/Math.pow(4,3-a)-7.5625*Math.pow((3*t-2)/22-e,2)}},__tempEasing=["Quad","Cubic","Quart","Quint","Expo"],i=0,l=__tempEasing.length;l>i;i++)easing[__tempEasing[i]]=function(e){return Math.pow(e,i+2)};__tempEasing=null;for(var name in easing)if(easing.hasOwnProperty(name)){var easeIn=easing[name];easing["easeIn"+name]=easeIn,easing["easeOut"+name]=function(e){return 1-easeIn(1-e)},easing["easeInOut"+name]=function(e){return.5>e?easeIn(2*e)/2:1-easeIn(-2*e+2)/2}}animatePaper.extendEasing=function(e){for(var t in e)e.hasOwnProperty(t)&&(easing[t]=e[t])},Animation.prototype.tick=function(){for(var e=this,t=(new Date).getTime(),a=Math.max(0,e.startTime+e.settings.duration-t),n=a/e.settings.duration||0,i=1-n,r=0,o=e.tweens.length;o>r;r++)e.tweens[r].run(i);return"undefined"!=typeof e.settings.step&&e.settings.step.call(e.item,{percent:i,remaining:a}),e.item.project.view.draw(),"timeout"===e.settings.mode,1>i&&o?a:(e.end(),!1)},Animation.prototype.stop=function(e){var t=this,a=0,n=e?t.tweens.length:0;if(t.stopped)return t;for(t.stopped=!0;n>a;a++)t.tweens[a].run(1);e&&t.end()},Animation.prototype.end=function(){var e=this;"onFrame"===e.settings.mode&&animatePaper.frameManager.remove(e.item,e.ticker),"undefined"!=typeof e.settings.complete&&e.settings.complete.call(e.item),"timeout"===e.settings.mode,"undefined"!=typeof e._continue&&e._continue.call(e.item),e=null};var _tweenPropHooks={_default:{get:function(e){var t;return null!=e.item[e.prop]&&(t=e.item[e.prop]),t},set:function(e){var t={};t[e.prop]=e.now,e.item.set(t)}},scale:{get:function(e){e.item.data._animatePaperVals||(e.item.data._animatePaperVals={}),"undefined"==typeof e.item.data._animatePaperVals.scale&&(e.item.data._animatePaperVals.scale=1);var t=e.item.data._animatePaperVals.scale;return t},set:function(e){var t=e.item.data._animatePaperVals.scale,a=e.now/t;e.item.data._animatePaperVals.scale=e.now,e.item.scale(a)}},rotate:{get:function(e){e.item.data._animatePaperVals||(e.item.data._animatePaperVals={}),"undefined"==typeof e.item.data._animatePaperVals.rotate&&(e.item.data._animatePaperVals.rotate=-0);var t=e.item.data._animatePaperVals.rotate;return t},set:function(e){var t=e.item.data._animatePaperVals.rotate,a=e.now-t;e.item.data._animatePaperVals.rotate=e.now,e.item.rotate(a)}},translate:{get:function(e){e.item.data._animatePaperVals||(e.item.data._animatePaperVals={}),"undefined"==typeof e.item.data._animatePaperVals.translate&&(e.item.data._animatePaperVals.translate=new paper.Point(0,0));var t=e.item.data._animatePaperVals.translate;return t},set:function(e){var t=e.item.data._animatePaperVals.translate,a=_pointDiff(e.now,t,"-");e.item.data._animatePaperVals.translate=e.now,e.item.translate(a)},ease:function(e,t){var a=_pointDiff(e.end,e.start,"-");return a.x=a.x*t,a.y=a.y*t,e.now=_pointDiff(a,e.start,"+"),e.now}},segmentGrow:{get:function(e){if(!(e.item instanceof paper.Path))throw new Error("Only a Path object can be used with : segmentGrow");var t=e.item.lastSegment.point;return t},set:function(e){e.item.add(e.now)},ease:function(e,t){var a=_pointDiff(e.end,e.start,"-");return a.x=a.x*t,a.y=a.y*t,e.now=_pointDiff(a,e.start,"+"),e.now}}};Tween.prototype.cur=function(){var e=this,t=_tweenPropHooks[e.prop];return t&&t.get?t.get(e):_tweenPropHooks._default.get(e)},Tween.prototype.run=function(e){var t,a=this,n=_tweenPropHooks[a.prop],i=a.A.settings;return a.pos=t=i.duration?easing[i.easing](e,i.duration*e,0,1,a.duration):e,n&&n.ease?n.ease(a,t):a.now=(a.end-a.start)*t+a.start,n&&n.set?n.set(a):_tweenPropHooks._default.set(a),a},animatePaper.fx={grow:function(e,t){return animatePaper.animate(e,{properties:{segmentGrow:t.to},settings:{easing:t.easing,complete:t.complete}}),e}},global.animatePaper=animatePaper,paper.Item.prototype.animate||(paper.Item.prototype.animate=function(e){return animatePaper.animate(this,e)})}(window,paper);