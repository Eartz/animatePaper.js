!function(exports,global){function Animation(t,e,a,n){var i=this;i.stopped=!1,i.startTime=(new Date).getTime(),i.settings=_initializeSettings(a),i.item=t,i.tweens=[],i.ticker=null,i._continue=n,"undefined"==typeof t.data._animatePaperAnims&&(i.item.data._animatePaperAnims=[]),i._dataIndex=i.item.data._animatePaperAnims.length,i.item.data._animatePaperAnims[i._dataIndex]=i;for(var r in e)e.hasOwnProperty(r)&&i.tweens.push(new Tween(r,e[r],i));"onFrame"===i.settings.mode&&(i.ticker=animatePaper.frameManager.add(i.item,"_animate"+i.startTime,function(){i.tick()}))}function _initializeSettings(t){var e={duration:400,easing:"linear",complete:void 0,step:void 0,mode:"onFrame"};return"undefined"==typeof t&&(t={}),"undefined"==typeof t.duration?t.duration=e.duration:(t.duration=Number(t.duration),t.duration<1&&(t.duration=e.duration)),"undefined"==typeof t.easing&&(t.easing=e.easing),"undefined"!=typeof easing[t.easing]&&easing.hasOwnProperty(t.easing)?t.easingFunction=easing[t.easing]:(t.easing=e.easing,t.easingFunction=easing[e.easing]),"function"!=typeof t.complete&&(t.complete=void 0),"function"!=typeof t.step&&(t.step=void 0),-1===["onFrame","timeout"].indexOf(t.mode)&&(t.mode=e.mode),t}function Tween(t,e,a){var n=this;n.A=a,n.item=a.item,n.prop=t,n.end=e,n.start=n.cur(),n.now=n.cur(),n.direction=n.end>n.start?"+":"-"}function frameManagerHandler(t){var e=this;if("undefined"!=typeof e.data._customHandlers&&e.data._customHandlersCount>0)for(var a in e.data._customHandlers)e.data._customHandlers.hasOwnProperty(a)&&"function"==typeof e.data._customHandlers[a]&&e.data._customHandlers[a].call(e,t)}function _pointDiff(a,b,operator){if(-1!==["+","-"].indexOf(operator)&&"undefined"!=typeof a&&"undefined"!=typeof b){var ax,bx,ay,by;ax=a.x||0,bx=b.x||0,ay=a.y||0,by=b.y||0;var output=new paper.Point(eval(ax+operator+bx),eval(ay+operator+by));return output}}global.animatePaper=exports;var paper=global.paper;Animation.prototype.tick=function(){var t=this;if(t.stopped)return!1;for(var e=(new Date).getTime(),a=Math.max(0,t.startTime+t.settings.duration-e),n=a/t.settings.duration||0,i=1-n,r=0,o=t.tweens.length;o>r;r++)t.tweens[r].run(i);return"undefined"!=typeof t.settings.step&&t.settings.step.call(t.item,{percent:i,remaining:a}),t.item.project.view.draw(),"timeout"===t.settings.mode,1>i&&o?a:(t.end(),!1)},Animation.prototype.stop=function(t){var e=this,a=0,n=t?e.tweens.length:0;if(e.stopped)return e;for(e.stopped=!0;n>a;a++)e.tweens[a].run(1);t&&(e._continue&&(e._continue=null),e.end())},Animation.prototype.end=function(){var t=this;"onFrame"===t.settings.mode&&animatePaper.frameManager.remove(t.item,t.ticker),"undefined"!=typeof t.settings.complete&&t.settings.complete.call(t.item),"timeout"===t.settings.mode,"function"==typeof t._continue&&t._continue.call(t.item),t.item.data._animatePaperAnims[t._dataIndex]=null,t=null},Tween.prototype.cur=function(){var t=this,e=_tweenPropHooks[t.prop];return e&&e.get?e.get(t):_tweenPropHooks._default.get(t)},Tween.prototype.run=function(t){var e,a=this,n=_tweenPropHooks[a.prop],i=a.A.settings;return a.pos=e=i.duration?easing[i.easing](t,i.duration*t,0,1,a.duration):t,n&&n.ease?n.ease(a,e):a.now=(a.end-a.start)*e+a.start,n&&n.set?n.set(a):_tweenPropHooks._default.set(a),a},animatePaper.frameManager={add:function(t,e,a){return"undefined"==typeof t.data._customHandlers&&(t.data._customHandlers={},t.data._customHandlersCount=0),t.data._customHandlers[e]=a,t.data._customHandlersCount+=1,t.data._customHandlersCount>0&&(t.onFrame=frameManagerHandler),e},remove:function(t,e){"undefined"!=typeof t.data._customHandlers&&(t.data._customHandlers[e]=null,t.data._customHandlersCount-=1,t.data._customHandlersCount<=0&&(t.data._customHandlersCount=0))}};for(var easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,a=4;t<((e=Math.pow(2,--a))-1)/11;);return 1/Math.pow(4,3-a)-7.5625*Math.pow((3*e-2)/22-t,2)}},__tempEasing=["Quad","Cubic","Quart","Quint","Expo"],i=0,l=__tempEasing.length;l>i;i++)easing[__tempEasing[i]]=function(t){return Math.pow(t,i+2)};__tempEasing=null;for(var name in easing)if(easing.hasOwnProperty(name)){var easeIn=easing[name];easing["easeIn"+name]=easeIn,easing["easeOut"+name]=function(t){return 1-easeIn(1-t)},easing["easeInOut"+name]=function(t){return.5>t?easeIn(2*t)/2:1-easeIn(-2*t+2)/2}}var _tweenPropHooks={_default:{get:function(t){var e;return null!=t.item[t.prop]&&(e=t.item[t.prop]),e},set:function(t){var e={};e[t.prop]=t.now,t.item.set(e)}},scale:{get:function(t){t.item.data._animatePaperVals||(t.item.data._animatePaperVals={}),"undefined"==typeof t.item.data._animatePaperVals.scale&&(t.item.data._animatePaperVals.scale=1);var e=t.item.data._animatePaperVals.scale;return e},set:function(t){var e=t.item.data._animatePaperVals.scale,a=t.now/e;t.item.data._animatePaperVals.scale=t.now,t.item.scale(a)}},rotate:{get:function(t){t.item.data._animatePaperVals||(t.item.data._animatePaperVals={}),"undefined"==typeof t.item.data._animatePaperVals.rotate&&(t.item.data._animatePaperVals.rotate=-0);var e=t.item.data._animatePaperVals.rotate;return e},set:function(t){var e=t.item.data._animatePaperVals.rotate,a=t.now-e;t.item.data._animatePaperVals.rotate=t.now,t.item.rotate(a)}},translate:{get:function(t){t.item.data._animatePaperVals||(t.item.data._animatePaperVals={}),"undefined"==typeof t.item.data._animatePaperVals.translate&&(t.item.data._animatePaperVals.translate=new paper.Point(0,0));var e=t.item.data._animatePaperVals.translate;return e},set:function(t){var e=t.item.data._animatePaperVals.translate,a=_pointDiff(t.now,e,"-");t.item.data._animatePaperVals.translate=t.now,t.item.translate(a)},ease:function(t,e){var a=_pointDiff(t.end,t.start,"-");return a.x=a.x*e,a.y=a.y*e,t.now=_pointDiff(a,t.start,"+"),t.now}},segmentGrow:{get:function(t){if(!(t.item instanceof paper.Path))throw new Error("Only a Path object can be used with : segmentGrow");var e=t.item.lastSegment.point;return e},set:function(t){t.item.add(t.now)},ease:function(t,e){var a=_pointDiff(t.end,t.start,"-");return a.x=a.x*e,a.y=a.y*e,t.now=_pointDiff(a,t.start,"+"),t.now}}};animatePaper.fx={grow:function(t,e){return animatePaper.animate(t,{properties:{segmentGrow:e.to},settings:{easing:e.easing,complete:e.complete}}),t}},exports.animate=function(t,e){var a=[];e instanceof Array?a=e:a.push(e);var n=0;return new Animation(t,a[n].properties,a[n].settings,function i(){n++,"undefined"!=typeof a[n]&&new Animation(t,a[n].properties,a[n].settings,i)}),t},exports.stop=function(t,e){if(t.data._animatePaperAnims)for(var a=0,n=t.data._animatePaperAnims.length;n>a;a++)t.data._animatePaperAnims[a]&&t.data._animatePaperAnims[a].stop(e);return t},exports.extendEasing=function(t){for(var e in t)t.hasOwnProperty(e)&&(easing[e]=t[e])},exports.extendPropHooks=function(t){for(var e in t)t.hasOwnProperty(e)&&(_tweenPropHooks[e]=t[e])},paper.Item.prototype.animate||(paper.Item.prototype.animate=function(t){return animatePaper.animate(this,t)}),paper.Item.prototype.stop||(paper.Item.prototype.stop=function(t){return animatePaper.stop(this,t)})}({},function(){return this}());